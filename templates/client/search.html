{% extends 'client_base.html' %}
{% load i18n %}

{% block extrahead %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/changelists.css" />
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/forms.css" />
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/dashboard.css" />
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/qs_filter.css" />


<script type="text/javascript">
function onsubmit_basket_form() {
  if(document.pressed == 'recalculate') {
   document.basket_form.action ="{% url client_basket_recalculate %}";
  }
  if(document.pressed == 'order') {
    document.basket_form.action ="{% url client_basket_order %}";
  }
  return true;
}
</script>

{% endblock %}

{% block page_title %}Поиск{% endblock %}

{% block content %}
<div id="divSearch" style="text-align: left; min-width: 800px;">
  <div style="width:30%" class="aligned">
    <form method="post" id="formSearch" action="">
      <div class="form-row">
        {{ form.maker.errors }}
        <label for="id_maker">Выберите марку* :</label> {{ form.maker }}
      </div>
      <div class="form-row">
        {{ form.part_number.errors }}
        <label for="id_part_number">Введите номер* :</label> {{ form.part_number }}
      </div>
      <div class="submit-row">
      <input type="submit" value="Искать" class="default" /></div>

    </form>
  </div>
    <h2>{{ msg|default:"" }}</h2>
    {% if found %}
    <form id="formFound" action="{% url client_basket_add %}" method="post">
        <table id="dataTable" width="750px">
            <tr>
                <td><b>Номер</b></td>
                <td><b>Описание</b></td>
                <td><b>Цена</b></td>
                <td><b>Ваша Цена</b></td>
                <td><b>Вы экономите</b></td>
            </tr>
            <tr>
                <input type="hidden" name="brand_name" value="{{ maker_name }}" />
                <td>{{ maker_name }}</td>
                <input type="hidden" name="part_number" value="{{ found.partnumber }}" />
                <td>{{ found.description }}</td>
                <input type="hidden" name="description" value="{{ found.description }}" />
                <td>{{ found.MSRP }}$</td>
                <input type="hidden" name="msrp" value="{{ found.MSRP }}" />
                <td>{{ found.your_price }}$</td>
                <input type="hidden" name="user_price" value="{{ found.your_price }}" />
                <input type="hidden" name="quantity" value="1" />
                <td>{{ found.your_economy}}$ или {{ found.your_economy_perc}}%</td>
                <td><input type="submit" name="_add_to_basket" value="В корзину" />
            </tr>
        </table>
    </form>
    {% endif %}
<div class=aligned" style="width: 750px">
{% if basket_items %}
<h3>Корзина</h3>
<form method="post" onsubmit="return onsubmit_basket_form();" id="id_basket_form" name="basket_form">
<table width="750px">
<tr>
<td><b>Марка</b></td>
<td><b>Номер</b></td>
<td><b>Описание</b></td>
<td><b>Цена за ед.</b></td>
<td><b>Стоимость</b></td>
<td><b>Количество</b></td>
<td><b>Удаление</b></td>
</tr>
{% for item in basket_items %}
<tr class="{% cycle row1,row2 %}">
<td>{{ item.brand_name }}</td>
<td>{{ item.part_number }}</td>
<td>{{ item.description }}</td>
<td>{{ item.user_price }}</td>
<td>{{ item.get_user_price_total }}</td>
<td><input size="5" type="text" name="quantity_{{item.id}}" value="{{ item.quantity }}" /></td>
<td><a class="delete_link" href="{% url client_basket_delete item.id %}">Удалить</a></td>
</tr>
{% endfor %}
<tr class="alt"><th colspan="4"><b>Общая стоимость:</b></th>
<th colspan="2"><b>{{ basket_user_price_sum }}</b></th>
<td><a class="delete_link" href="{% url client_basket_clear %}">Очистить корзину</a></td>
</tr>
</table>
<div class="submit-row">

<input type="submit" name="operation" onclick="document.pressed='recalculate'" value="Пресчитать" />
<input type="submit" class="default" name="operation" onclick="document.pressed='order'" value="Заказать" />
&nbsp;&nbsp;&nbsp;

</div>
</form>
{% endif %}
</div>
</div>
{% endblock %}

