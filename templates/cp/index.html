{% extends 'cp_base.html' %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/admin_table.css">
<script>
//var used = new Array();
var current_id;
var current_val;
var current = new Array();
function save() {
    value = jQuery('#' + type + '_input_' + current['id']).val();
    jQuery('#' + type + '_' + id).html('<img src="{{ MEDIA_URL }}img/icons/ajax-loader.gif">')
    jQuery.ajax(
        {
            type: 'POST',
            url: '/cp/position/edit/' + current['id'] + '/',
            data: {
                    'type':current['type'],
                    'value':value
                   },
            success: function(response) {
	            r = eval('['+response+']');
                current['value'] = r[0]['value'];
                close();
            }
        });
    
}

function close() {
    if (!current.length) return;
    jQuery('#' + current['type'] + '_' + id).html(current['value']);
    jQuery('#quantity_save_btn_' + current['id']).css("display","none");
    current = new Array();
}
function editQuantity(id) {
    alert(current['id'] == id);
    alert(current['type'] == 'quantity');
    alert(current.length);
    if (current.length > 0 && current['id'] == id && current['type'] == 'quantity') return;
    if (current.length) close();
    current = {'type':'quantity', 'value':jQuery('#quantity_'+id).html(),'id':id};
    
    jQuery('#quantity_'+id).html('<input id="quantity_input_' + id + '" type="text" value="' + current['value'] + '">');
    jQuery('#quantity_save_btn_'+id).css("display","inline");
    
}
</script>
{% endblock %}

{% block content %}
{% if items %}
<table class="admin_table">
<tr>
<th>Order</th>
<th>Side</th>
<th>Brand</th>
<th>Part #</th>
<th>Superseded</th>
<th>Price</th>
<th>Quantity</th>
<th>Status</th>
<th>&nbsp;</th>
</tr>
{% for i in items %}
<tr>
<td>{{ i.order.po }}</td>
<td>{{ i.side|default:"&nbsp;" }}</td>
<td>{{ i.brand|default:"&nbsp;" }}</td>
<td>{{ i.part_number|default:"&nbsp;" }}</td>
<td>{{ i.part_number_superseded|default:"&nbsp;" }}</td>
<td>{{ i.price|default:"&nbsp;" }}</td>
<td><div id="quantity_{{ i.id }}" onclick="editQuantity({{ i.id }})">{{ i.quantity|default:"&nbsp;" }}</div>
<button id="quantity_save_btn_{{ i.id }}" style="display: none" onclick="save()">Save</button>
</td>
<td>{{ i.status|default:"&nbsp;" }}</td>
<td><a href="/cp/position/edit/{{ i.id }}">Edit</a></td>
</tr>
{% endfor %}
</table>
{% else %}
Нет ни одной записи
{% endif %}
{% include "paginator.html" %}
{% endblock %}