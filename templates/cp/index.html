{% extends 'cp_base.html' %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/admin_table.css">
<script>
var current = {'id':null,'type':null,'value':null};
function save() {
    value = jQuery('#' + current.type + '_input_' + current.id).val();
    jQuery('#' + current.type + '_' + current.id).html('<img src="{{ MEDIA_URL }}img/icons/ajax-loader.gif">')
    jQuery.ajax(
        {
            type: 'POST',
            url: '/cp/position/edit/' + current.id + '/',
            data: {
                    'type':current.type,
                    'value':value
                   },
            success: function(response) {
	            r = eval('['+response+']');
                current.value = r[0]['value'];
                if (r[0]['error']) alert(r[0]['error']);
                close();
            }
        });
    
}

function close() {
    jQuery('#' + current.type + '_' + current.id).html(current.value);
    jQuery('#' + current.type + '_buttons_' + current.id).css("display","none");
    current = {'id':null,'type':null,'value':null};
}

function editSuperseded(id) {
    if (current.id == id && current.type == 'part_number_superseded') return;
    if (current.id) close();
    current.type = 'part_number_superseded'; 
    current.value = jQuery('#part_number_superseded_'+id).html();
    current.id = id;
    
    jQuery('#part_number_superseded_'+id).html('<input id="part_number_superseded_input_' + id + '" type="text" value="' + current.value + '">');
    jQuery('#part_number_superseded_buttons_'+id).css("display","inline");
    
}

function editPrice(id) {
    if (current.id == id && current.type == 'price') return;
    if (current.id) close();
    current.type = 'price'; 
    current.value = jQuery('#price_'+id).html();
    current.id = id;
    
    jQuery('#price_'+id).html('<input id="price_input_' + id + '" type="text" value="' + current.value + '">');
    jQuery('#price_buttons_'+id).css("display","inline");
    
}

function editQuantity(id) {
    if (current.id == id && current.type == 'quantity') return;
    if (current.id) close();
    current.type = 'quantity'; 
    current.value = jQuery('#quantity_'+id).html();
    current.id = id;
    
    jQuery('#quantity_'+id).html('<input id="quantity_input_' + id + '" type="text" value="' + current.value + '">');
    jQuery('#quantity_buttons_'+id).css("display","inline");
    
}

function editStatus(id) {
    if (current.id == id && current.type == 'status') return;
    if (current.id) close();
    current.type = 'status'; 
    current.value = jQuery('#status_'+id).html();
    current.id = id;
    html = '<select id="status_input_' + id + '">';
    options = {'on_order':'On order',
              'out_of_stock':'Out of stock',
              'back_order':'Back order',
              'wrong_number':'Wrong number',
              'not_produce':'Not produce'}
    for (i in options) {
        option_html = '<option value="' + i + '"';
        if (current.value == i) option_html += ' selected';
        option_html += '>' + options[i] + '</option';
        html += option_html;
    }
    html += '</select>';
      
    jQuery('#status_'+id).html(html);
    jQuery('#status_buttons_'+id).css("display","inline");
    
}
</script>
{% endblock %}

{% block content %}

<a href="/cp/">В виде таблицы</a><a href="/cp/groups/">По группам</a>
{% if items %}
<table class="admin_table">
<tr>
<th>Order</th>
<th>Side</th>
<th>Brand</th>
<th>Part #</th>
<th>Superseded</th>
<th>Price</th>
<th>Quantity</th>
<th>Status</th>
</tr>
{% for i in items %}
<tr>
<td>{{ i.order.po }}</td>
<td>{{ i.side|default:"&nbsp;" }}</td>
<td>{{ i.brand|default:"&nbsp;" }}</td>
<td>{{ i.part_number|default:"&nbsp;" }}</td>
<td><div id="part_number_superseded_{{ i.id }}" style="cursor: pointer" onclick="editSuperseded({{ i.id }})">{{ i.part_number_superseded|default:"&nbsp;" }}</div>
<span id="part_number_superseded_buttons_{{ i.id }}" style="display: none"><button onclick="save()">Save</button><button onclick="close()">Cancel</button></span>
</td>
<td><div id="price_{{ i.id }}" style="cursor: pointer" onclick="editPrice({{ i.id }})">{{ i.price|default:"&nbsp;" }}</div>
<span id="price_buttons_{{ i.id }}" style="display: none"><button onclick="save()">Save</button><button onclick="close()">Cancel</button></span>
</td>
<td><div id="quantity_{{ i.id }}" style="cursor: pointer" onclick="editQuantity({{ i.id }})">{{ i.quantity|default:"&nbsp;" }}</div>
<span id="quantity_buttons_{{ i.id }}" style="display: none"><button onclick="save()">Save</button><button onclick="close()">Cancel</button></span>
</td>
<td><div id="status_{{ i.id }}" style="cursor: pointer" onclick="editStatus({{ i.id }})">{{ i.status|default:"&nbsp;" }}</div>
<span id="status_buttons_{{ i.id }}" style="display: none"><button onclick="save()">Save</button><button onclick="close()">Cancel</button></span>
</td>
</tr>
{% endfor %}
</table>
{% else %}
Нет ни одной записи
{% endif %}
{% include "paginator.html" %}
{% endblock %}