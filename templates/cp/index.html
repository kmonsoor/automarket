{% extends 'cp_base.html' %}
{% load cp_tags %}

{% block extrahead %}
{{ block.super }}
<script>
var caller = 'index';
var brands = [
	{{ brands|safe }}
	];
</script>

<script type="text/javascript" src="{{ MEDIA_URL }}js/order_processing.js"></script>
<script>
backend_url = '/cp/position/edit/ordered_item/';
get_brandgroup_settings_url = '/cp/get_brandgroup_settings/'
</script>
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/changelists.css" />
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/forms.css" />
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/dashboard.css" />
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/qs_filter.css" />

<style type="text/css">
td {
    padding: 1px;
    font-size: 80%;
}
input, select {
  font-size: 90%;
}
td.center {
text-align: center;

}

td.right {
text-align: right;
}


.module {
    background: none repeat scroll 0 0 white;
    background: none repeat scroll 0 0 white;
    border: none;
    margin-bottom: 5px;
}

table {
	border: 1px solid #DDD;
}

tr.alt td {
	font-weight: 600;
}

</style>
{% endblock %}

{% block content %}
<div class="" id="changelist">
<form method="{{ filter.method }}" action="/cp/{% if items_per_page %}?items_per_page={{ items_per_page }}{% endif %}">
<a href="/cp/export_order/">Экспорт</a><br/><br/>
<input type="hidden" name="qs_filter" value="1">
<input type="submit" value="Фильтр">
<input type="submit" name="qs_filter_clear" value="Очистить">
Количество записей на странице:
<select onchange="location.href='{{ request.path }}?items_per_page=' + this.value">
<option value="20"{% ifequal items_per_page 20 %} selected {% endifequal %}>20</option>
<option value="50"{% ifequal items_per_page 50 %} selected {% endifequal %}>50</option>
<option value="100"{% ifequal items_per_page 100 %} selected {% endifequal %}>100</option>
</select>

<div class="module" id="changelist">

<table>
<thead>
<tr>{% table_header_sort headers %}</tr>
<tr{% if filter.is_set %} style="border: solid 2px green;"{% endif %}>
<td></td>
<td>{{ filter.form.brandgroup__title__contains }}</td>
<td>{{ filter.form.area__title__contains }}</td>
<td>{{ filter.form.brand__title__contains }}</td>
<td>{{ filter.form.part_number__contains }}</td>
<td>{{ filter.form.comment_customer__contains }}</td>
<td>{{ filter.form.comment_supplier__contains }}</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>{{ filter.form.part_number_superseded__contains }}</td>
<td>{{ filter.form.manager__username__contains }}</td>
<td>{{ filter.form.client__username__contains }}</td>
<td>{{ filter.form.description_ru__contains }}</td>
<td>{{ filter.form.description_en__contains }}</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>{{ filter.form.invoice_code__contains }}</td>
<td>{{ filter.form.status }}</td>
</tr>
</thead>
<tbody>
<style>
	table td {padding:1px 5px; vertical-align: middle;}
</style>
{% for i in items %}
	<tr class="{% cycle row1,row2 %}">
		<td>{{ i.get_po_verbose }}</td>
		<td>{{ i.brandgroup }}</td>
		<td>{{ i.area }}</td>
		<td>{{ i.brand }}</td>
		{% comment %}
		<td class="editable" onclick="editPartNumber({{ i.id }})">
			<div id="part_number_display_{{ i.id }}">{{ i.part_number|default:"" }}</div>
			<div id="part_number_{{ i.id }}" style="display: none">{{ i.part_number|default:"" }}</div>
			<span id="part_number_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		{% endcomment %}
		<td>
		{{ i.part_number|default:"" }}
		</td>
		<td>
		{{ i.comment_customer|default:"" }}
		</td>
		<td class="editable" onclick="editCommentSupplier({{ i.id }})">
			<div id="comment_supplier_display_{{ i.id }}">{{ i.comment_supplier|default:"" }}</div>

			<div id="comment_supplier_{{ i.id }}" style="display: none">{{ i.comment_supplier|default:"" }}</div>
			<span id="comment_supplier_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td align="center">
			{{ i.created|date:"d.m.Y <\\b\\r\\\> H:i"|safe }}
		</td>
		<td>
			<div id="quantity_display_{{ i.id }}">{{ i.quantity|default:"" }}</div>
			<div id="quantity_{{ i.id }}" style="display: none">{{ i.quantity|default:"" }}</div>
		</td>
		<td class="editable" onclick="editPriceInvoice({{ i.id }})">
			<div id="price_invoice_display_{{ i.id }}">{{ i.price_invoice|default:"" }}</div>
			<div id="price_invoice_{{ i.id }}" style="display: none">{{ i.price_invoice|default:"" }}</div>
			<span id="price_invoice_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td>
			<div id="total_w_ship_{{ i.id }}">{{ i.total_w_ship|default:"" }}</div>
		</td>
		<td class="editable" onclick="editSuperseded({{ i.id }})">
			<div id="part_number_superseded_display_{{ i.id }}">{{ i.part_number_superseded|default:"" }}</div>
			<div id="part_number_superseded_{{ i.id }}" style="display: none">{{ i.part_number_superseded|default:"" }}</div>
			<span id="part_number_superseded_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td>{{ i.manager }}</td>
		<td>{{ i.client }}{% if i.client_order_id %}/{{ i.client_order_id }}{% endif %}</td>
		<td class="editable" onclick="editDescriptionRu({{ i.id }})">
			<div id="description_ru_display_{{ i.id }}" style="overflow: hidden">{{ i.description_ru|default:"" }}</div>
			<div id="description_ru_{{ i.id }}" style="display: none">{{ i.description_ru|default:"" }}</div>
			<span id="description_ru_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td class="editable" onclick="editDescriptionEn({{ i.id }})">
			<div id="description_en_display_{{ i.id }}">{{ i.description_en|default:"" }}</div>
			<div id="description_en_{{ i.id }}" style="display: none">{{ i.description_en|default:"" }}</div>
			<span id="description_en_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td class="editable" onclick="editPriceBase({{ i.id }})">
			<div id="price_base_display_{{ i.id }}">{{ i.price_base|default:"" }}</div>
			<div id="price_base_{{ i.id }}" style="display: none;">{{ i.price_base|default:"" }}</div>
			<span id="price_base_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td class="editable" onclick="editWeight({{ i.id }})">
			<div id="weight_display_{{ i.id }}">{{ i.weight|default:"" }}</div>
			<div id="weight_{{ i.id }}" style="display: none">{{ i.weight|default:"" }}</div>
			<span id="weight_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td id="delivery_{{ i.id }}">
			<div id="delivery_display_{{ i.id }}">{{ i.delivery|default:"" }}</div>
			<input type="hidden" name="delivery_supplier_input_{{ i.id }}" id="delivery_supplier_input_{{ i.id }}" value="{% if i.brandgroup.delivery %}{{ i.brandgroup.delivery }}{% else %}13{% endif %}">
		</td>
		<td id="price_sale_{{ i.id }}">{{ i.price_sale|default:"" }}</td>
		<td class="editable" onclick="editPriceDiscount({{ i.id }})">
			<div id="price_discount_display_{{ i.id }}">{{ i.price_discount|default:"" }}</div>
			<div id="price_discount_{{ i.id }}" style="display: none">{{ i.price_discount|default:"" }}</div>
			<span id="price_discount_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td id="cost_{{ i.id }}">{{ i.cost|default:"" }}</td>
		<td id="total_cost_{{ i.id }}">{{ i.total_cost|default:"" }}</td>

		<td class="editable" onclick="editInvoiceCode({{ i.id }})">
			<div id="invoice_code_display_{{ i.id }}">{{ i.invoice_code|default:"" }}</div>
			<div id="invoice_code_{{ i.id }}" style="display: none">{{ i.invoice_code|default:"" }}</div>
			<span id="invoice_code_buttons_{{ i.id }}" style="display: none"><button onclick="save(); return false;">Save</button><button onclick="cancel(); return false;">Cancel</button></span>
		</td>
		<td class="editable">
			<select id="status_input_{{ i.id }}" onchange="editStatus({{ i.id }}, this.value)">
			{% for opt in status_options %}
				{% ifequal i.status 'order' %}
					{% ifequal opt.value 'order' %}
						<option value="{{ opt.value }}"{% ifequal opt.value i.status %} selected{% endifequal %}>{{ opt.option|lower }}</option>
					{% endifequal %}
				{% else %}
					{% ifnotequal opt.value 'order' %}
						<option value="{{ opt.value }}"{% ifequal opt.value i.status %} selected{% endifequal %}>{{ opt.option|lower }}</option>
					{% endifnotequal %}
				{% endifequal %}
			{% endfor %}
			</select>
		</td>

	</tr>
{% endfor %}
{% if total_row %}
	<tr class="alt">
	<td><strong>Итого:</strong></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td>&nbsp;</td>
	<td>{{ total_row.WEIGHT|default:0|floatformat:3 }}</td>
	<td> {{ total_row.DELIVERY|default:0|floatformat:3 }}</td>
	<td>{{ total_row.PRICE|default:0|floatformat:3 }}</td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td>{{ total_row.COST|floatformat:".02f" }}</td>
	<td></td>
	<td></td>		
	</tr>
{% endif %}
</tbody>
</table>

</div>

</form>

{% include "paginator.html" %}
</div>

{% endblock %}

